<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>View File - <%= filename %></title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #111;
        color: #fff;
        padding: 20px;
      }
      a {
        color: #0bf;
        text-decoration: none;
      }
      a:hover {
        text-decoration: underline;
      }
      .breadcrumb {
        margin-bottom: 20px;
      }
      video, audio, pre {
        width: 100%;
        margin-top: 20px;
        background: #222;
        padding: 15px;
        border-radius: 8px;
      }
      pre {
        white-space: pre-wrap;
        word-wrap: break-word;
      }
    </style>
  </head>
  <body>
    <div class="breadcrumb">
      <a href="/">Home</a>
      <% if (path) {
        const parts = path.split('/').filter(Boolean);
        let partial = ''; %>
        <% parts.forEach((part, index) => {
          partial += '/' + part;
          const isLast = index === parts.length - 1; %>
          ‚Ä∫
          <% if (isLast) { %>
            <span><%= part %></span>
          <% } else { %>
            <a href="/files?path=<%= encodeURIComponent(partial) %>"><%= part %></a>
          <% } %>
        <% }); %>
      <% } %>
    </div>

    <h2>üìÑ <%= filename %></h2>
    <p>
      <a href="/download?path=<%= encodedPath %>">‚¨áÔ∏è Download</a>
    </p>

    <% const ext = filename.split('.').pop().toLowerCase(); %>

    <% if (['mp4', 'webm', 'mkv'].includes(ext)) { %>
      <video controls>
        <source src="/stream?path=<%= encodedPath %>" type="video/<%= ext === 'mkv' ? 'webm' : ext %>">
        Your browser does not support the video tag.
      </video>
    <% } else if (['mp3', 'wav', 'ogg'].includes(ext)) { %>
      <audio controls>
        <source src="/stream?path=<%= encodedPath %>" type="audio/<%= ext %>">
        Your browser does not support the audio tag.
      </audio>
    <% } else if (['txt', 'log', 'json'].includes(ext)) { %>
      <pre><%= require('fs').readFileSync(path.join(__dirname, '../../', decodeURIComponent(encodedPath)), 'utf-8') %></pre>
    <% } else { %>
      <p>No preview available.</p>
    <% } %>
  </body>
</html>
