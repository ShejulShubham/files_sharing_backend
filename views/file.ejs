<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>View File - <%= filename %></title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <style>
      .filename-title {
        word-break: break-all;
        overflow-wrap: anywhere;
      }

      pre {
        white-space: pre-wrap;
        word-wrap: break-word;
        overflow-x: auto;
      }

      .breadcrumb {
        flex-wrap: wrap;
        font-size: 0.95rem;
      }

      .breadcrumb-item a {
        text-decoration: none;
      }
    </style>
  </head>
  <body class="bg-dark text-light">
    <div class="container py-4">
      <!-- Filename Heading -->
      <h2 class="filename-title">
        <i class="fas fa-file-alt"></i>
        <span title="<%= filename %>"><%= filename %></span>
      </h2>

      <!-- Breadcrumb -->
      <% if (path) { const parts = path.split('/').filter(Boolean); let partial = ''; %>
      <nav aria-label="breadcrumb" class="mt-3 mb-4">
        <ol class="breadcrumb bg-transparent p-0 m-0">
          <li class="breadcrumb-item">
            <a href="/" class="text-light">Home</a>
          </li>
          <% parts.forEach((part, index) => {
               partial += '/' + part;
               const isLast = index === parts.length - 1;
          %>
          <li class="breadcrumb-item <%= isLast ? 'active text-warning' : '' %>">
            <% if (isLast) { %><%= part %><% } else { %>
              <a href="/files?path=<%= encodeURIComponent(partial) %>" class="text-light"><%= part %></a>
            <% } %>
          </li>
          <% }) %>
        </ol>
      </nav>
      <% } %>

      <!-- Buttons -->
      <div class="mb-3">
        <a href="/download?path=<%= encodedPath %>" class="btn btn-primary btn-sm me-2">
          <i class="fas fa-download"></i> Download
        </a>
        <a href="javascript:history.back()" class="btn btn-outline-light btn-sm">
          <i class="fas fa-arrow-left"></i> Back
        </a>
      </div>

      <!-- File Preview -->
      <% const ext = filename.split('.').pop().toLowerCase();
         const imageTypes = ['jpg', 'jpeg', 'png', 'gif', 'webp', 'svg', 'bmp'];
         const videoTypes = ['mp4', 'webm', 'mkv'];
         const audioTypes = ['mp3', 'wav', 'ogg'];
         const textTypes = ['txt', 'log', 'json', 'md']; %>

      <% if (imageTypes.includes(ext)) { %>
        <img src="/stream?path=<%= encodedPath %>" alt="<%= filename %>" class="img-fluid rounded shadow mt-3" />
      <% } else if (videoTypes.includes(ext)) { %>
        <video class="w-100 rounded mt-3" controls>
          <source src="/stream?path=<%= encodedPath %>" type="video/<%= ext === 'mkv' ? 'webm' : ext %>" />
          Your browser does not support the video tag.
        </video>
      <% } else if (audioTypes.includes(ext)) { %>
        <audio class="w-100 mt-3" controls>
          <source src="/stream?path=<%= encodedPath %>" type="audio/<%= ext %>" />
          Your browser does not support the audio tag.
        </audio>
      <% } else if (textTypes.includes(ext)) { %>
        <div class="bg-secondary p-3 rounded mt-3">
          <pre class="text-white mb-0"><%= fileContent || '(empty file)' %></pre>
        </div>
      <% } else { %>
        <div class="alert alert-info mt-3">
          Preview not available for this file type.
        </div>
      <% } %>
    </div>
  </body>
</html>
