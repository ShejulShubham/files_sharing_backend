<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Status - File Sharing App</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f7f7f7;
      color: #333;
    }
    h1 {
      font-size: 20px;
      color: #2c3e50;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    p {
      margin: 10px 0;
    }
    .label {
      font-weight: bold;
    }
    a {
      color: #0077cc;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    button {
      margin: 8px 6px 8px 0;
      padding: 8px 16px;
      background-color: #0077cc;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #005fa3;
    }
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
    }
    .btn-row {
      margin-top: 20px;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
</head>
<body>
  <h1>
    üìÅ Shared Folder:
    <button onclick="showQRCode()">üì± QR Code</button>
  </h1>
  <p id="folder-path"></p>

  <h1>üåê Access URLs:</h1>
  <p><span class="label">Local:</span> <a id="local-url" target="_blank"></a></p>
  <p><span class="label">LAN:</span> <a id="lan-url" target="_blank"></a></p>

  <p>üü¢ Server is running. You can close this window.</p>

  <div class="btn-row">
    <button onclick="openInWindow()">üñ•Ô∏è Open in App</button>
    <button onclick="openInBrowser()">üåê Open in Browser</button>
  </div>

  <div id="qrModal" class="modal">
    <div class="modal-content">
      <h3>Scan to Access</h3>
      <canvas id="qrCanvas"></canvas><br /><br />
      <button onclick="hideQRCode()">Close</button>
    </div>
  </div>

  <script>
    const { ipcRenderer, shell } = require("electron");

    let localUrl = "";
    let lanUrl = "";

    ipcRenderer.on("app-data", (_, data) => {
      document.getElementById("folder-path").textContent = data.sharedPath;
      document.getElementById("local-url").textContent = data.url;
      document.getElementById("local-url").href = data.url;
      document.getElementById("lan-url").textContent = data.networkUrl;
      document.getElementById("lan-url").href = data.networkUrl;

      localUrl = data.url;
      lanUrl = data.networkUrl;
    });

    function openInBrowser() {
      ipcRenderer.send("open-in-browser", localUrl);
    }

    function openInWindow() {
      window.open(localUrl);
    }

    function showQRCode() {
      const canvas = document.getElementById("qrCanvas");
      const modal = document.getElementById("qrModal");

      QRCode.toCanvas(canvas, lanUrl, { width: 200 }, function (err) {
        if (err) console.error(err);
        else modal.style.display = "flex";
      });
    }

    function hideQRCode() {
      document.getElementById("qrModal").style.display = "none";
    }
  </script>
</body>
</html>
